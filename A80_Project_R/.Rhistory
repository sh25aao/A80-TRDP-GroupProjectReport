install.packages("tidyverse")
library(tidyverse)
# ============================================================
# Ohio COVID-19: Boxplots by Year + Histogram with Normal Curve
# Dependent: Confirmatory + Presumptive Daily Percent Positive
# Libraries: tidyverse only
# Output: PNG plots + summary CSV + ANOVA TXT
# ============================================================
# 0) Libraries ------------------------------------------------
# install.packages("tidyverse") # run once if needed
library(tidyverse)
# 1) Load data -----------------------------------------------
data_path <- "TestingDetails.csv"  # change if needed
df <- readr::read_csv(data_path, show_col_types = FALSE)
# 2) Prepare variables ---------------------------------------
# Parse Date and create Year (using base R to avoid extra packages)
df <- df %>%
mutate(
Date = as.Date(Date, format = "%m/%d/%Y"),
Year = as.integer(format(Date, "%Y"))
)
# Dependent variable (fraction 0..1 in file) -> percentage
dv_col <- "Confirmatory and Presumptive Lab Percent Positive (Daily)"
df_dep <- df %>%
select(Date, Year, !!dv_col) %>%
filter(Year %in% c(2020, 2021, 2022), !is.na(.data[[dv_col]])) %>%
mutate(Percent = .data[[dv_col]] * 100)
# ============================================================
# Ohio COVID-19: Boxplots by Year + Histogram with Normal Curve
# Dependent: Confirmatory + Presumptive Daily Percent Positive
# Libraries: tidyverse only
# Output: PNG plots + summary CSV + ANOVA TXT
# ============================================================
# 0) Libraries ------------------------------------------------
# install.packages("tidyverse") # run once if needed
library(tidyverse)
# 1) Load data (treat 'N/A' and blanks as missing) -----------
data_path <- "TestingDetails.csv"  # change path if needed
df <- readr::read_csv(
file = data_path,
na = c("N/A", "NA", "", " "),
show_col_types = FALSE
)
# 2) Prepare variables ---------------------------------------
# Parse Date with base R (avoid extra packages) and create Year
df <- df %>%
mutate(
Date = as.Date(Date, format = "%m/%d/%Y"),
Year = as.integer(format(Date, "%Y"))
)
# Name of the dependent variable column as it appears in the CSV
dv_col <- "Confirmatory and Presumptive Lab Percent Positive (Daily)"
# Ensure DV is numeric: coerce safely (non-numeric -> NA)
df <- df %>%
mutate(
`Confirmatory and Presumptive Lab Percent Positive (Daily)` =
suppressWarnings(as.numeric(`Confirmatory and Presumptive Lab Percent Positive (Daily)`))
)
# Create analysis frame (2020–2022, non-missing DV) and convert to percent
df_dep <- df %>%
select(Date, Year, !!dv_col) %>%
filter(Year %in% c(2020, 2021, 2022)) %>%
rename(DV = !!dv_col) %>%
filter(!is.na(DV)) %>%
mutate(Percent = DV * 100)
# 3) Descriptive statistics by year --------------------------
summary_by_year <- df_dep %>%
group_by(Year) %>%
summarise(
n = n(),
mean_percent = mean(Percent),
sd_percent   = sd(Percent),
.groups = "drop"
)
print(summary_by_year)
# 4) Plot 1: Boxplots by Year --------------------------------
p_box <- ggplot(df_dep, aes(x = factor(Year), y = Percent)) +
geom_boxplot(
width = 0.6,
outlier.colour = "gray25",
fill = c("#1f77b4", "#2ca02c", "#d62728"),
alpha = 0.25
) +
# Mean marker as a crossbar
stat_summary(fun = mean, geom = "crossbar",
width = 0.5, colour = "black", size = 0.4, fatten = 0.8) +
scale_y_continuous(labels = function(x) paste0(x, "%")) +
labs(
title    = "Ohio COVID-19 Testing: Daily Percent Positive by Year (2020–2022)",
subtitle = "Boxplots show median, IQR, outliers; black crossbar = mean",
x = "Year (Independent variable: Date grouped to Year)",
y = "Daily percent positive (%)\n(Confirmatory + Presumptive)"
) +
theme_minimal(base_size = 12) +
theme(plot.title = element_text(face = "bold"),
panel.grid.minor = element_blank())
# Show and save
print(p_box)
ggplot2::ggsave("boxplot_by_year_R.png", p_box, width = 9, height = 5.5, dpi = 200)
# 5) Plot 2: Histogram + Normal curve overlay -----------------
mu  <- mean(df_dep$Percent)
sdv <- sd(df_dep$Percent)
p_hist <- ggplot(df_dep, aes(x = Percent)) +
geom_histogram(aes(y = ..density..), bins = 40,
fill = "#1f77b4", alpha = 0.40, color = "white") +
stat_function(fun = dnorm, args = list(mean = mu, sd = sdv),
colour = "#d62728", size = 1.2) +
scale_x_continuous(labels = function(x) paste0(x, "%")) +
labs(
title    = "Distribution of Daily Percent Positive (Ohio, 2020–2022)",
subtitle = sprintf("Normal curve overlay: \u03BC = %.2f%%, \u03C3 = %.2f%%", mu, sdv),
x = "Daily percent positive (%)\n(Confirmatory + Presumptive)",
y = "Density"
) +
theme_minimal(base_size = 12) +
theme(plot.title = element_text(face = "bold"),
panel.grid.minor = element_blank())
# Show and save
print(p_hist)
ggplot2::ggsave("histogram_with_normal_R.png", p_hist, width = 9, height = 5.5, dpi = 200)
# 6) ANOVA (difference in means across years) -----------------
anova_model <- aov(Percent ~ factor(Year), data = df_dep)
anova_summary <- summary(anova_model)
print(anova_summary)
# 7) Kruskal–Wallis (non-parametric check) -------------------
kw <- kruskal.test(Percent ~ factor(Year), data = df_dep)
print(kw)
# 8) Save summary & test outputs ------------------------------
readr::write_csv(summary_by_year, "summary_by_year_R.csv")
sink("anova_results_R.txt")
cat("ANOVA (Percent ~ Year)\n")
print(anova_summary)
cat("\nKruskal-Wallis (Percent ~ Year)\n")
print(kw)
sink()
# 9) End message ---------------------------------------------
message("Done. Files saved:\n - boxplot_by_year_R.png\n - histogram_with_normal_R.png\n - summary_by_year_R.csv\n - anova_results_R.txt")
# 4) Plot 1: Boxplots by Year (without subtitle) -------------
p_box <- ggplot(df_dep, aes(x = factor(Year), y = Percent)) +
geom_boxplot(
width = 0.6,
outlier.colour = "gray25",
fill = c("#1f77b4", "#2ca02c", "#d62728"),
alpha = 0.25
) +
stat_summary(fun = mean, geom = "crossbar",
width = 0.5, colour = "black", size = 0.4, fatten = 0.8) +
scale_y_continuous(labels = function(x) paste0(x, "%")) +
labs(
title = "Ohio COVID-19 Testing: Daily Percent Positive by Year (2020–2022)",
x = "Year (Independent variable: Date grouped to Year)",
y = "Daily percent positive (%)\n(Confirmatory + Presumptive)"
) +
theme_minimal(base_size = 12) +
theme(plot.title = element_text(face = "bold"),
panel.grid.minor = element_blank())
# Show and save
print(p_box)
ggsave("boxplot_by_year_R.png", p_box, width = 9, height = 5.5, dpi = 200)
# ===============================================
# Base R boxplot: Daily Percent Positive by Year
# No tidyverse/ggplot2 used
# ===============================================
# 1) Load data with base R (treat 'N/A' etc. as missing)
df <- read.csv("TestingDetails.csv",
stringsAsFactors = FALSE,
na.strings = c("N/A", "NA", "", " "))
# 2) Parse Date and create Year using base R
df$Date <- as.Date(df$Date, format = "%m/%d/%Y")
df$Year <- as.integer(format(df$Date, "%Y"))
# 3) Identify the dependent variable column (name after read.csv has dots)
dv_name <- names(df)[grepl("Confirmatory.and.Presumptive.Lab.Percent.Positive.*Daily",
names(df))]
if (length(dv_name) != 1) stop("Could not find DV column. Run names(df) to inspect.")
# Coerce DV to numeric (non-numeric becomes NA), then convert to percent
dv_raw <- suppressWarnings(as.numeric(df[[dv_name]]))
keep   <- !is.na(dv_raw) & df$Year %in% c(2020, 2021, 2022)
df_sub <- df[keep, ]
Percent <- dv_raw[keep] * 100
# 4) Reshape to WIDE: one column per Year (like months->columns in demo)
split_by_year <- split(Percent, df_sub$Year)
# Ensure column order 2020, 2021, 2022
years_order <- c("2020", "2021", "2022")
split_by_year <- split_by_year[years_order]
# Pad columns to equal length so boxplot can stack them
max_len <- max(sapply(split_by_year, length))
pad_to  <- function(x, n) { length(x) <- n; x }
wide_mat <- sapply(split_by_year, pad_to, n = max_len)
wide_df  <- as.data.frame(wide_mat)
names(wide_df) <- years_order
# 5) Plot & save with base R
png("boxplot_by_year_baseR.png", width = 900, height = 550, res = 120)
par(mar = c(5, 5, 4, 2) + 0.1)
boxplot(
wide_df,
col = c("#1f77b4", "#2ca02c", "#d62728"),
ylab = "Daily percent positive (%)\n(Confirmatory + Presumptive)",
xlab = "Year (Independent variable: Date grouped to Year)",
main = "Ohio COVID-19 Testing: Daily Percent Positive by Year (2020–2022)"
)
# Optional grid
grid(nx = NA, ny = NULL, col = "grey85", lty = "dotted")
# Overlay MEAN as short horizontal segments (to reflect 'average + variance')
means <- sapply(wide_df, function(col) mean(col, na.rm = TRUE))
for (i in seq_along(means)) {
segments(x0 = i - 0.25, y0 = means[i], x1 = i + 0.25, y1 = means[i],
lwd = 2, col = "#111111")
}
legend("topright", legend = c("Mean (overlay)"), lwd = 2, col = "#111111", bty = "n")
dev.off()
# 6) (Optional) Save summary table like in demo
summary_table <- data.frame(
Year = as.integer(years_order),
MeanPercent = means,
SDPercent = sapply(wide_df, function(col) sd(col, na.rm = TRUE)),
N = sapply(wide_df, function(col) sum(!is.na(col)))
)
write.csv(summary_table, "summary_by_year_baseR.csv", row.names = FALSE)
png("boxplot_by_year_baseR_clean.png", width = 900, height = 550, res = 120)
par(mar = c(5, 6, 4, 2) + 0.1)
boxplot(
wide_df,
col = c("#1f77b4", "#2ca02c", "#d62728"),
ylab = "Daily percent positive (%)\n(Confirmatory + Presumptive)",
xlab = "Year (Independent variable: Date grouped to Year)",
main = "Ohio COVID-19 Testing: Daily Percent Positive by Year (2020–2022)",
pch = 16, cex = 0.6, range = 1.5
)
# mean overlay only (no legend)
means <- sapply(wide_df, function(col) mean(col, na.rm = TRUE))
for (i in seq_along(means)) {
segments(i - 0.25, means[i], i + 0.25, means[i], lwd = 2, col = "#111111")
}
dev.off()
# ================================
# Boxplot with ggplot2 (tidyverse)
# Colors match your base-R plot
# ================================
# 1) Load tidyverse
library(tidyverse)
# 2) Read the CSV (mark common NA strings as missing)
df <- readr::read_csv(
"TestingDetails.csv",
na = c("N/A", "NA", "", " "),
show_col_types = FALSE
)
# 3) Prepare basic columns
# - Convert Date to Date type
# - Extract Year (as a category)
# - Make sure the dependent variable is numeric
dv <- "Confirmatory and Presumptive Lab Percent Positive (Daily)"
df <- df %>%
mutate(
Date = as.Date(Date, format = "%m/%d/%Y"),
Year = as.integer(format(Date, "%Y")),
# Coerce DV to numeric (non-numeric becomes NA silently)
`Confirmatory and Presumptive Lab Percent Positive (Daily)` =
suppressWarnings(as.numeric(`Confirmatory and Presumptive Lab Percent Positive (Daily)`))
)
# 4) Build a simple analysis frame (only 2020–2022)
df_dep <- df %>%
filter(Year %in% c(2020, 2021, 2022)) %>%
transmute(
Year = factor(Year),                               # treat Year as category
Percent = `Confirmatory and Presumptive Lab Percent Positive (Daily)` * 100
) %>%
filter(!is.na(Percent))                              # drop missing values
# 5) Make the boxplot
# - Boxes show median and IQR; whiskers show range; dots are outliers
# - Add a thin black crossbar to show the mean (average)
# - Use exact fill colors to match base-R
p_box <- ggplot(df_dep, aes(x = Year, y = Percent, fill = Year)) +
geom_boxplot(width = 0.65, alpha = 0.25,
outlier.colour = "black", outlier.size = 1.6) +
stat_summary(fun = mean, geom = "crossbar",
width = 0.5, colour = "black", size = 0.5) +
scale_fill_manual(values = c("2020" = "#1f77b4",
"2021" = "#2ca02c",
"2022" = "#d62728")) +
scale_y_continuous(labels = function(x) paste0(x, "%")) +
labs(
title = "Ohio COVID-19 Testing: Daily Percent Positive by Year (2020–2022)",
x = "Year (independent variable from Date)",
y = "Daily percent positive (%)\n(Confirmatory + Presumptive)"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold"),
panel.grid.minor = element_blank(),
legend.position = "none"   # legend not needed; years shown on x-axis
)
# 6) Show the plot
print(p_box)
# 7) Save as PNG
ggsave("boxplot_by_year_ggplot_simple.png",
p_box, width = 9, height = 5.5, dpi = 200)
# ================================
# Boxplot with ggplot2 (solid colors)
# Match base-R palette exactly
# ================================
library(tidyverse)
# 1) Read CSV (mark common NA tokens as missing)
df <- readr::read_csv(
"TestingDetails.csv",
na = c("N/A", "NA", "", " "),
show_col_types = FALSE
)
# 2) Prepare minimal columns (Date -> Year, DV -> Percent)
dv <- "Confirmatory and Presumptive Lab Percent Positive (Daily)"
df <- df %>%
mutate(
Date = as.Date(Date, format = "%m/%d/%Y"),
Year = as.integer(format(Date, "%Y")),
# Coerce DV to numeric; non-numeric becomes NA
`Confirmatory and Presumptive Lab Percent Positive (Daily)` =
suppressWarnings(as.numeric(`Confirmatory and Presumptive Lab Percent Positive (Daily)`))
)
# 3) Build analysis frame (only 2020–2022), set factor levels in order
df_dep <- df %>%
filter(Year %in% c(2020, 2021, 2022)) %>%
transmute(
Year = factor(Year, levels = c(2020, 2021, 2022)),
Percent = `Confirmatory and Presumptive Lab Percent Positive (Daily)` * 100
) %>%
filter(!is.na(Percent))
# 4) Define exact base-R colors (solid)
year_cols <- c("2020" = "#1f77b4",  # blue
"2021" = "#2ca02c",  # green
"2022" = "#d62728")  # red
# 5) Boxplot (no transparency, solid fills; mean crossbar; black outliers)
p_box <- ggplot(df_dep, aes(x = Year, y = Percent, fill = Year)) +
geom_boxplot(width = 0.65,        # box width
outlier.colour = "black",
outlier.size = 1.8) +# solid outliers
stat_summary(fun = mean, geom = "crossbar",
width = 0.5, colour = "black", size = 0.6) +
scale_fill_manual(values = year_cols) +          # solid base-R colors
scale_y_continuous(labels = function(x) paste0(x, "%")) +
labs(
title = "Ohio COVID-19 Testing: Daily Percent Positive by Year (2020–2022)",
x = "Year (independent variable from Date)",
y = "Daily percent positive (%)\n(Confirmatory + Presumptive)"
) +
theme_minimal(base_size = 12) +                  # simple theme
theme(
plot.title = element_text(face = "bold"),
panel.grid.minor = element_blank(),
legend.position = "none"                       # legend not needed
)
# 6) Show & save
print(p_box)
ggsave("boxplot_by_year_ggplot_solid.png",
p_box, width = 9, height = 5.5, dpi = 200)
